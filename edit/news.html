<?php
$form = false;
if(isset($_GET['newnews'])) {
	if($_GET['newnews'] == "yes") {
		$sql = "INSERT INTO `XENUX_news`(`id`, `title`, `text`) VALUES (NULL, 'Titel','Text')";
		$erg = mysql_query($sql);
	}
}
if(!empty($_GET['delnews'])) {
	$sql = "DELETE FROM XENUX_news WHERE id = '".$_GET['delnews']."'";
	$erg = mysql_query($sql);
	echo 'Die News wurde soeben erfolgreich gelöscht!<br />';
}
if(!empty($_GET['newspoint'])) {
$newspoint = mysql_real_escape_string($_GET['newspoint']);
	if(isset($_POST['sub2'])) {
		$title = mysql_real_escape_string($_POST['title']);
		$text = mysql_real_escape_string($_POST['text']);
			$sql = "UPDATE XENUX_news Set title = '$title', text = '$text' WHERE id = '$newspoint'";
			$erg = mysql_query($sql);
			echo "Die News wurde gespeichert!<br />";
			echo "<a href='../?site=news&id=$newspoint'>News anzeigen</a><br />";
			echo "<a href='./?site=news'>Weiteren News bearbeiten</a><br />";
			echo "Vorschau:<br />";
			echo "<div id='vorschau'>";
			$sql = "SELECT * FROM XENUX_news WHERE id = '$newspoint'";
			$erg = mysql_query($sql);
			$row = mysql_fetch_object($erg);
			echo "<strong>$row->title</strong><br />$row->text";
			exit;
	}else {
		echo 'Du bearbeitest gerade die News '.$newspoint.'!';
		$sql = "SELECT * FROM XENUX_news WHERE id = '".$newspoint."'";
		$erg = mysql_query($sql);
		$row = mysql_fetch_array($erg);
		$title = $row['title'];
		$text = $row['text'];
		$form = true;
	}
		if($form){
		?>
		<form action="" method="post">
			<span <?php if (empty($title) and $_SERVER['REQUEST_METHOD'] == "POST"){echo 'style="color:#cc0000;"';} ?>>Titel:</span><br />
			<input type="text" name="title" size="70" value="<?php echo $title; ?>" /><br /><br />
			<span <?php if (empty($text) and $_SERVER['REQUEST_METHOD'] == "POST"){echo 'style="color:#cc0000;"';} ?>>Text:</span><br />
			<textarea type="text" name="text" cols="90" rows="13"><?php echo $text; ?></textarea><br /><br />
			<input type="submit" name="sub2" value="speichern">
		</form>
		<?php
		exit;
		}
}
?>
<p>Hier kannst du die News bearbeiten.</p>
<br />
<table id="table1">
<tr><th>News-Nummer</th><th>Titel</th><th>Text</th><th></th><th></th></tr>
<?php
$sql = "SELECT * FROM XENUX_news";
$erg = mysql_query($sql);
while($row = mysql_fetch_array($erg)) {
	echo "<tr>";
	echo "<td>".$row['id']."</td>";
	echo "<td>".$row['title']."</td>";
	echo "<td>".$row['text']."</td>";
	echo "<td><a id=\"edit_href\" style=\"font-size: 0.9em;\" href=\"./?site=news&newspoint=".$row['id']."\">Bearbeiten</a></td>";
	echo "<td><a id=\"edit_href\" style=\"font-size: 0.9em;\" href=\"./?site=news&delnews=".$row['id']."\">löschen</a></td>";
	echo "</tr>";
}
?>
</table>
<br />
<br />
<a id="edit_href" style="font-size: 1em;" href="./?site=news&newnews=yes">neue News</a>