<?php
$umlaute = Array("ä","ö","ü","Ä","Ö","Ü","ß");
$replace = Array("ae","oe","ue","Ae","Oe","Ue","ss");
$Fehlercodes = array(
						0 => "Es trat kein Fehler, die Datei wurde erfolgreich hochgeladen",
						1 => "Die hochgeladene Datei überschreitet die Maximale Größe von 30 MB",
						2 => "Die hochgeladene Datei überschreitet die Maximale Größe von 30 MB",
						3 => "Die hochgeladene Datei wurde nur teilweise hochgeladen",
						4 => "Es wurde keine Datei hochgeladen",
						6 => "Es fehlt ein temporären Ordner"
); 
if(!file_exists("../files/")) {
	mkdir("../files/");
}
if(!empty($_POST['submit'])) {
	$uploaddir = substr($_SERVER['SCRIPT_FILENAME'],	0,strrpos($_SERVER['SCRIPT_FILENAME'],"/"));
	$uploaddir = substr($uploaddir,					0,strrpos($uploaddir,"/") + 1 );
	$fullfilename = str_replace($umlaute, $replace, basename($_FILES['userfile']['name']));
	$filename = substr($fullfilename,0,strpos($fullfilename, "."));
	$filetyp = substr($fullfilename,strpos($fullfilename, "."));
	if(file_exists($uploaddir.'files/'.$filename.$filetyp)) {
		$i = 1;
		while(file_exists($uploaddir.'files/'.$filename.'_1'.$filetyp)){
		$i++;
		}
		$uploadfile = $uploaddir.'files/'.$filename.'_'.$i.$filetyp;
	} else {
		$uploadfile = $uploaddir.'files/'.$filename.$filetyp;
	};
	if (move_uploaded_file($_FILES['userfile']['tmp_name'], $uploadfile)) {
		echo "Die Datei wurde erfolgreich hochgeladen!<br />";
	} else {
		echo "<p style=\"color:red;\">Beim Hochladen der Datei trat folgender Fehler auf:<br />";
		echo $Fehlercodes[$_FILES["userfile"]["error"]];
		echo "</p>";
	}
}
?>
<p>Hier kannst du deine Datei(-en) hochladen.</p>
<p><a href="?site=dateitools">Dateien anzeigen</a></p>
<form enctype="multipart/form-data" action="" method="POST">
<input type="hidden" name="MAX_FILE_SIZE" value="31457280" />
Diese Datei hochladen: <input name="userfile" type="file" />
<input type="submit" name="submit" value="Datei hochladen" />
</form>